(()=>{"use strict";var e,t={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"473808f0-5776-421d-958a-53a27ae403b4","Content-Type":"application/json"}},n=function(){return fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers})};function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",(function(t){return a(t,e)}))}function o(e,t){e.addEventListener("click",(function(){r(t)}))}function c(e){e.addEventListener("click",(function(t){t.target===e&&r(e)}))}function a(e,t){"Escape"===e.key&&r(t)}function u(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",(function(t){return a(t,e)}))}function i(e){e.classList.toggle("card__like-button_is-active"),e.classList.contains("card__like-button_is-active")?e.closest(".card").querySelector(".card__like-count").textContent=Number(e.closest(".card").querySelector(".card__like-count").textContent)+1:e.closest(".card").querySelector(".card__like-count").textContent=Number(e.closest(".card").querySelector(".card__like-count").textContent)-1}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t.querySelector("button");e.addEventListener("input",(function(){var t=0===e.value.length,o=!!n&&e.value.length>=n,c=!e.validity.valid;t||o||c?(e.classList.add("invalid"),r.setAttribute("disabled",!0)):(e.classList.remove("invalid"),r.removeAttribute("disabled"))}))}n().then((function(e){return e.json()})).then((function(t){e=t._id}));var s,d,_,p,f=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__add-button"),v=document.querySelector(".places__list"),m=document.querySelector(".profile__image"),b=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),q=document.querySelector(".popup_type_avatar"),k=function(){fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return e.json()})).then((function(t){t.forEach((function(t){v.append(function(t){var n=document.querySelector("#card-template").content.cloneNode(!0);n.querySelector(".places__item").setAttribute("id",t._id);var r=n.querySelector(".card__image"),o=n.querySelector(".card__title"),c=n.querySelector(".card__like-button"),a=n.querySelector(".card__like-count");return r.setAttribute("src",t.link),r.setAttribute("alt",t.name),t.likes.find((function(t){return t._id===e}))&&c.classList.add("card__like-button_is-active"),e===t.owner._id&&r.insertAdjacentHTML("afterend",'<button type="button" class="card__delete-button"></button>'),o.textContent=t.name,a.textContent=t.likes.length,n}(t))}))}))};k(),s=document.querySelector(".profile__title"),d=document.querySelector(".profile__description"),_=document.querySelector(".profile__image"),(p=document.createElement("img")).alt="avatar image",p.style.width="120px",p.style.height="120px",_.append(p),n().then((function(e){return e.json()})).then((function(e){s.textContent=e.name,d.textContent=e.about,p.setAttribute("src",e.avatar)})),m.addEventListener("click",(function(){u(q);var e=q.querySelector(".popup__close"),a=q.querySelector("form"),i=a.querySelector("button"),s=q.querySelector(".popup__input_type_url");l(s,a),c(q),o(e,q),a.addEventListener("submit",(function e(o){o.preventDefault();var c=s.value;i.textContent="Сохраняем...",i.disabled=!0,function(e){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})})}(c).then((function(){var e;e=document.querySelector(".profile__image").querySelector("img"),n().then((function(e){return e.json()})).then((function(t){e.setAttribute("src",t.avatar)}))})).finally((function(){i.textContent="Сохранить",i.disabled=!1,r(q)})),a.removeEventListener("submit",e)}))})),f.addEventListener("click",(function(){u(b);var e=b.querySelector(".popup__close"),n=b.querySelector("form"),a=n.querySelector("button"),i=b.querySelector(".popup__input_type_name"),s=b.querySelector(".popup__input_type_description"),d=document.querySelector(".profile__title"),_=document.querySelector(".profile__description");i.value=d.textContent,s.value=_.textContent,l(i,n,40),l(s,n,200),c(b),o(e,b),n.addEventListener("submit",(function(e){e.preventDefault(),a.textContent="Сохраняем...",a.disabled=!0,function(e,n){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e,about:n})})}(i.value,s.value).then((function(){d.textContent=i.value,_.textContent=s.value})).finally((function(){r(b),a.textContent="Сохранить",a.disabled=!1}))}))})),y.addEventListener("click",(function(){u(h);var e=h.querySelector(".popup__close"),n=h.querySelector("form"),a=n.querySelector("button"),i=h.querySelector(".popup__input_type_card-name"),s=h.querySelector(".popup__input_type_url");l(i,n),l(s,n),c(h),o(e,h),n.addEventListener("submit",(function e(o){o.preventDefault();var c=i.value,u=s.value;a.textContent="Сохраняем...",a.disabled=!0,function(e,n){return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:e,link:n})})}(c,u).then((function(){v.innerHTML="",k()})).finally((function(){r(h),a.textContent="Сохранить",a.disabled=!1})),n.removeEventListener("submit",e)}))})),v.addEventListener("click",(function(e){var n,r=e.target,a=r.classList;switch(!0){case a.contains("card__like-button"):var l=r.closest(".card").getAttribute("id");r.classList.contains("card__like-button_is-active")?(n=l,fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:t.headers})).then((function(){return i(r)})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers})}(l).then((function(){return i(r)}));break;case a.contains("card__delete-button"):(function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers})})(r.parentNode.getAttribute("id")).then((function(){r.parentNode.remove()}));break;case a.contains("card__image"):!function(e,t){u(t);var n=t.querySelector(".popup__close"),r=t.querySelector("img");r.setAttribute("src",e.getAttribute("src")),r.setAttribute("alt",e.getAttribute("alt")),c(t),o(n,t)}(r,S)}}))})();